version: '3.8'

services:
  # 1. ğŸŒ API Gateway (Nginx)
  nginx-proxy:
    container_name: nexus_gateway
    image: nginx:stable-alpine
    restart: always
    ports:
      # í˜¸ìŠ¤íŠ¸ 8081 í¬íŠ¸ë¥¼ ì»¨í…Œì´ë„ˆ 80 í¬íŠ¸ë¡œ ë§¤í•‘ (ì™¸ë¶€ ì ‘ê·¼ í†µë¡œ)
      - "8081:80" 
    volumes:
      # Nginx ì„¤ì • íŒŒì¼ ë§ˆìš´íŠ¸ 
      - ./nginx/nginx.conf:/etc/nginx/nginx.conf:ro
      - ./nginx/conf.d:/etc/nginx/conf.d:ro
    depends_on:
      # APIì™€ UI ì„œë¹„ìŠ¤ê°€ ë¨¼ì € ì‹¤í–‰ëœ í›„ Nginxê°€ ì‹œì‘ë˜ì–´ì•¼ í•¨
      - nexus-ui
      # - nexus-api

  nexus-ui:
    container_name: nexus-ui
    image: nexus-ui
    build:
      # â­ ìˆ˜ì •: í˜„ì¬ í´ë”(nexus-infra)ì—ì„œ í•œ ë‹¨ê³„ ìƒìœ„(../)ë¡œ ì´ë™ í›„ nexus-ui í´ë” ì§€ì •
      context: ../nexus-ui 
      dockerfile: Dockerfile
    restart: always
    # hot reloadë¥¼ ìœ„í•´ ì†ŒìŠ¤ ì½”ë“œ ë§ˆìš´íŠ¸
    volumes:
      - ../nexus-ui:/app
    expose:
      - "3000"

#  # 2. Backend Service (Spring Boot) - ë¶€í•˜ ë¶„ì‚°ì„ ìœ„í•´ 2ê°œë¡œ ë³µì œ
#  backend:
#    # ë°±ì—”ë“œ ì†ŒìŠ¤ ì½”ë“œê°€ ìˆëŠ” í´ë”ë¥¼ ì§€ì •í•´ì•¼ í•©ë‹ˆë‹¤. (ì˜ˆ: backend-spring)
#    build:
#      context: ./backend-spring
#    # ì¤‘ìš”: ì™¸ë¶€ì— í¬íŠ¸ë¥¼ ë…¸ì¶œí•˜ì§€ ì•Šê³ , ë‚´ë¶€ í†µì‹ ë§Œ ê°€ëŠ¥í•˜ë„ë¡ 'expose' ì‚¬ìš©
#    expose:
#      - "8080"
#    environment:
#      # DB ì»¨í…Œì´ë„ˆ ì´ë¦„(db)ì„ ì‚¬ìš©í•˜ì—¬ ì ‘ì† ì£¼ì†Œ ì„¤ì •
#      - DB_URL=jdbc:mysql://db:3306/mydb
#      - DB_USER=root
#      - DB_PASS=secret
#    deploy:
#      replicas: 2  # â­ í•µì‹¬: ë°±ì—”ë“œ ì»¨í…Œì´ë„ˆë¥¼ 2ê°œ ë„ì›€
#    restart: always
#
#  # 3. Database Service (Single DB)
#  db:
#    image: mysql:8.0
#    container_name: nexus-db
#    environment:
#      MYSQL_ROOT_PASSWORD: secret
#      MYSQL_DATABASE: mydb
#    # ë°ì´í„° ìœ ì§€ë¥¼ ìœ„í•´ ë³¼ë¥¨ ì‚¬ìš©
#    volumes:
#      - db_data:/var/lib/mysql 
#    restart: always
#
#volumes:
#  db_data: