version: '3.8'

services:
  # 1. Frontend Service (Web Server & Reverse Proxy)
  frontend:
    # Dockerfile 경로를 'nexus-ui' 폴더로 지정합니다.
    build: 
      context: ./nexus-ui
    container_name: nexus-web
    ports:
      - "80:80"  # 외부에는 80 포트만 노출
#    depends_on:
#      - backend
    restart: always

#  # 2. Backend Service (Spring Boot) - 부하 분산을 위해 2개로 복제
#  backend:
#    # 백엔드 소스 코드가 있는 폴더를 지정해야 합니다. (예: backend-spring)
#    build:
#      context: ./backend-spring
#    # 중요: 외부에 포트를 노출하지 않고, 내부 통신만 가능하도록 'expose' 사용
#    expose:
#      - "8080"
#    environment:
#      # DB 컨테이너 이름(db)을 사용하여 접속 주소 설정
#      - DB_URL=jdbc:mysql://db:3306/mydb
#      - DB_USER=root
#      - DB_PASS=secret
#    deploy:
#      replicas: 2  # ⭐ 핵심: 백엔드 컨테이너를 2개 띄움
#    restart: always
#
#  # 3. Database Service (Single DB)
#  db:
#    image: mysql:8.0
#    container_name: nexus-db
#    environment:
#      MYSQL_ROOT_PASSWORD: secret
#      MYSQL_DATABASE: mydb
#    # 데이터 유지를 위해 볼륨 사용
#    volumes:
#      - db_data:/var/lib/mysql 
#    restart: always
#
#volumes:
#  db_data: